generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Company {
  id        String   @id @default(uuid())
  name      String
  slug      String   @unique
  ruc       String?
  website   String?
  address   String?
  phone     String?
  email     String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  updatedBy String?

  users User[]
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String // Hash del password (bcrypt)
  firstName String
  lastName  String
  isActive  Boolean  @default(true)
  companyId String
  roleId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?
  updatedBy String?

  company Company @relation(fields: [companyId], references: [id], onDelete: Cascade)
  role    Role    @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@index([companyId])
}

model Role {
  id          String   @id @default(uuid())
  name        String // Ej: "Administrador", "Vendedor", "Supervisor"
  slug        String // Ej: "admin", "sales", "supervisor"
  description String?
  canRead     Boolean  @default(true)
  canCreate   Boolean  @default(true)
  canUpdate   Boolean  @default(true)
  canDelete   Boolean  @default(true)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   String?
  updatedBy   String?

  // company         Company          @relation(fields: [companyId], references: [id], onDelete: Cascade)
  users User[]
  Menu  RoleMenu[]
  // rolePermissions RolePermission[]

  @@unique([name]) // Un rol único por nombre dentro de cada empresa
  @@unique([slug]) // Un rol único por nombre dentro de cada empresa
}

model Menu {
  id          String   @id @default(uuid())
  code        String   @unique // Código único interno: "sales", "inventory", "reports"
  name        String // Nombre por defecto: "Ventas", "Inventario", "Reportes"
  description String?
  path        String   @unique // Ruta en el frontend: "/ventas", "/inventario"
  icon        String? // Nombre del ícono (ej: "shopping-cart", "package")
  order       Int      @default(0) // Orden por defecto
  parentId    String? // Para menús anidados (submenús)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   String?
  updatedBy   String?

  parent    Menu?      @relation("MenuHierarchy", fields: [parentId], references: [id])
  subMenu   Menu[]     @relation("MenuHierarchy")
  roleMenus RoleMenu[]

  // @@index([parentId])
}

model RoleMenu {
  id          String   @id @default(uuid())
  roleId      String
  menuId      String
  isActive    Boolean  @default(true) // Permite deshabilitar sin eliminar
  customName  String? // Nombre personalizado para este rol
  customIcon  String? // Ícono personalizado para este rol
  customOrder Int? // Orden personalizado para este rol
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  role Role @relation(fields: [roleId], references: [id], onDelete: Cascade)
  menu Menu @relation(fields: [menuId], references: [id], onDelete: Cascade)

  @@unique([roleId, menuId])
  @@index([roleId])
  @@index([menuId])
}
